    
    const nameInput = document.getElementById('displayName');
    const saveNameBtn = document.getElementById('saveNameBtn');
    const resetBtn = document.getElementById('clearBtn');
    const msgInput = document.getElementById('messageInput');
    const sendBtn = document.getElementById('sendBtn');
    const listEl = document.getElementById('messages');
    const connEl = document.getElementById('conn');
    const imageInput = document.getElementById('imageInput');
    const imageBtn = document.getElementById('imageBtn');
    const uploadArea = document.getElementById('uploadArea');
    const typingIndicator = document.getElementById('typingIndicator');
    const onlineCount = document.getElementById('onlineCount');
    const onlineUsersList = document.getElementById('onlineUsersList');
    const userCount = document.getElementById('userCount');
    
    // New feature elements
    const searchMessages = document.getElementById('searchMessages');
    const searchBtn = document.getElementById('searchBtn');
    const replyIndicator = document.getElementById('replyIndicator');
    const replyText = document.getElementById('replyText');
    const cancelReply = document.getElementById('cancelReply');
    const scrollToBottom = document.getElementById('scrollToBottom');
    const darkBtn = document.getElementById('darkBtn');
    const lightBtn = document.getElementById('lightBtn');
    const autoScroll = document.getElementById('autoScroll');
    const soundNotifications = document.getElementById('soundNotifications');
    const testSoundBtn = document.getElementById('testSoundBtn');
    const notificationVolume = document.getElementById('notificationVolume');
    const notificationVolumeValue = document.getElementById('notificationVolumeValue');
    const compactMode = document.getElementById('compactMode');
    const messageLimit = document.getElementById('messageLimit');
    const messageLimitValue = document.getElementById('messageLimitValue');
    
    // GIF Elements
    const gifBtn = document.getElementById('gifBtn');
    const gifPanel = document.getElementById('gifPanel');
    const gifSearchInput = document.getElementById('gifSearchInput');
    const gifSearchBtn = document.getElementById('gifSearchBtn');
    const gifResults = document.getElementById('gifResults');
    
    // Emoji Elements
    const emojiBtn = document.getElementById('emojiBtn');
    const emojiPanel = document.getElementById('emojiPanel');
    const emojiSearch = document.getElementById('emojiSearch');
    const emojiGrid = document.getElementById('emojiGrid');
    
    // Voice Chat Elements
    const joinVcBtn = document.getElementById('joinVcBtn');
    const vcButtons = document.getElementById('vcButtons');
    const muteBtn = document.getElementById('muteBtn');
    const deafenBtn = document.getElementById('deafenBtn');
    const settingsBtn = document.getElementById('settingsBtn');
    const leaveVcBtn = document.getElementById('leaveVcBtn');
    const participantsCard = document.getElementById('participantsCard');
    const participantsList = document.getElementById('participantsList');
    const participantCount = document.getElementById('participantCount');
    const settingsCard = document.getElementById('settingsCard');
    const volumeSlider = document.getElementById('volumeSlider');
    const volumeValue = document.getElementById('volumeValue');
    const testMicBtn = document.getElementById('testMicBtn');

    // App State
    let inVoiceChat = false;
    let isMuted = false;
    let isDeafened = false;
    let mediaStream = null;
    let userId = Math.random().toString(36).substr(2, 9);
    let typingTimeout;
    let isTyping = false;
    let currentReply = null;
    let allMessages = [];
    let isSearching = false;
    let currentTheme = localStorage.getItem('pleb_theme') || 'dark';
    let currentMessageLimit = parseInt(localStorage.getItem('pleb_message_limit')) || 200;
    let currentNotificationVolume = parseInt(localStorage.getItem('pleb_notification_volume')) || 50;
    let windowFocused = true;
    let lastUserActivity = Date.now();

    // Helpers
    const STORAGE_KEY = 'pleb_chat_name';
    const VERIFIED_KEY = 'pleb_chat_verified';
    const messagesRef = ref(db, 'messages');
    const presenceRef = ref(db, '.info/connected');
    const voiceParticipantsRef = ref(db, 'voice_participants');
    const userVoiceRef = ref(db, `voice_participants/${userId}`);
    const kickedUsersRef = ref(db, 'kicked_users');
    const typingRef = ref(db, 'typing');
    const userTypingRef = ref(db, `typing/${userId}`);
    const onlineUsersRef = ref(db, 'online_users');
    const userOnlineRef = ref(db, `online_users/${userId}`);

    // Initialize theme
    document.documentElement.setAttribute('data-theme', currentTheme);
    if (currentTheme === 'light') {
      lightBtn.classList.add('active');
      darkBtn.classList.remove('active');
    }

    // Initialize message limit
    messageLimit.value = currentMessageLimit;
    messageLimitValue.textContent = currentMessageLimit;

    // Initialize notification volume
    notificationVolume.value = currentNotificationVolume;
    notificationVolumeValue.textContent = currentNotificationVolume + '%';

    // Focus tracking
    window.addEventListener('focus', () => {
      windowFocused = true;
      lastUserActivity = Date.now();
      updateUserStatus();
    });

    window.addEventListener('blur', () => {
      windowFocused = false;
      updateUserStatus();
    });

    // Activity tracking
    document.addEventListener('mousemove', () => {
      lastUserActivity = Date.now();
    });
    document.addEventListener('keypress', () => {
      lastUserActivity = Date.now();
    });
    document.addEventListener('click', () => {
      lastUserActivity = Date.now();
    });

    // Enhanced notification system
    function createNotificationSound(soundType = 'message') {
      try {
        const sound = NOTIFICATION_SOUNDS[soundType] || NOTIFICATION_SOUNDS.message;
        const audio = new Audio(sound.data);
        audio.volume = currentNotificationVolume / 100;
        return audio;
      } catch (e) {
        console.error('Error creating notification sound:', e);
        return null;
      }
    }

    function playNotificationSound(type = 'message') {
      if (!soundNotifications.checked) return;
      
      try {
        const audio = createNotificationSound(type);
        if (audio) {
          audio.play().catch(err => console.log('Sound play failed:', err));
        }
      } catch (e) {
        console.error('Error playing notification:', e);
      }
    }

    function testNotificationSound() {
      playNotificationSound('message');
      flashStatus('ğŸ”Š Sound test!');
    }

    // User status management
    function getUserStatus() {
      if (!windowFocused) return 'unfocused';
      const timeSinceActivity = Date.now() - lastUserActivity;
      if (timeSinceActivity > 30000) return 'unfocused'; // 30 seconds
      return 'online';
    }

    function updateUserStatus() {
      const name = getName();
      if (!name) return;

      const status = getUserStatus();
      set(userOnlineRef, {
        name: name,
        status: status,
        lastSeen: serverTimestamp(),
        userId: userId
      }).catch(err => console.error('Status update error:', err));
    }

    // Update user status every 10 seconds
    setInterval(updateUserStatus, 10000);

    function renderOnlineUsers(users) {
      onlineUsersList.innerHTML =<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pleb</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root { --bg:#0f1220; --card:#161a2b; --pill:#0d6efd22; --accent:#7dd3fc; --muted:#a3aed0; --text:#e6e9ff; --success:#22c55e; --danger:#ef4444; --warning:#f59e0b; --admin:#dc2626; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background: linear-gradient(180deg, #0b0e1a, #090c17); color: var(--text); }
    .wrap { max-width: 1200px; margin: 0 auto; padding: 24px; display: grid; grid-template-columns: 1fr 280px; gap: 20px; }
    .main { display: flex; flex-direction: column; }
    .sidebar { display: flex; flex-direction: column; gap: 16px; }
    header { display:flex; align-items:center; justify-content:space-between; gap: 16px; margin-bottom: 16px; }
    .title { font-size: clamp(20px, 3vw, 28px); font-weight: 700; letter-spacing: 0.3px; }
    .card { background: var(--card); border: 1px solid #1f2440; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,.35); overflow: hidden; }
    .row { display:flex; gap:12px; align-items: center; }
    .stack { display:grid; gap:12px; }
    .section { padding: 16px; border-bottom: 1px solid #1f2440; }
    .section:last-child { border-bottom: 0; }
    label { font-size: 12px; color: var(--muted); display:block; margin-bottom: 6px; }
    input[type="text"], input[type="password"], input[type="number"], select { width: 100%; padding: 12px 14px; border-radius: 12px; background: #0e1222; border: 1px solid #262c4f; color: var(--text); outline: none; }
    input[type="text"]::placeholder, input[type="password"]::placeholder { color: #6b7196; }
    input[type="file"] { display: none; }
    input[type="range"] { width: 100%; accent-color: var(--accent); }
    input[type="checkbox"] { accent-color: var(--accent); }
    button { padding: 10px 14px; border-radius: 12px; border: 1px solid #2a3163; background: #1b2150; color: var(--text); font-weight: 600; cursor: pointer; transition: transform .05s ease, background .2s; }
    button:hover { background: #232a6a; }
    button:active { transform: translateY(1px); }
    button:disabled { opacity: 0.5; cursor: not-allowed; }
    button.success { background: var(--success); border-color: var(--success); color: white; }
    button.success:hover { background: #16a34a; }
    button.danger { background: var(--danger); border-color: var(--danger); color: white; }
    button.danger:hover { background: #dc2626; }
    button.warning { background: var(--warning); border-color: var(--warning); color: white; }
    button.warning:hover { background: #d97706; }
    button.active { background: var(--accent); border-color: var(--accent); color: #0f1220; }
    .btn-icon { padding: 8px; min-width: 36px; display: flex; align-items: center; justify-content: center; }
    #messages { height: min(50vh, 400px); overflow-y: auto; background: #0b0f20; padding: 8px; border-radius: 12px; border: 1px solid #1b2144; position: relative; }
    .msg { display:grid; gap:4px; padding: 10px 12px; background: #0e1329; border: 1px solid #20264a; border-radius: 12px; margin: 8px; position: relative; }
    .msg.compact { padding: 6px 8px; margin: 4px; }
    .msg-admin { border-color: var(--admin); background: rgba(220, 38, 38, 0.1); }
    .msg-image { max-width: 300px; max-height: 200px; border-radius: 8px; margin-top: 8px; cursor: pointer; }
    .msg-reply-button { position: absolute; top: 8px; right: 8px; opacity: 0; transition: opacity 0.2s; padding: 4px 8px; font-size: 10px; }
    .msg:hover .msg-reply-button { opacity: 1; }
    .msg-reply-to { font-size: 11px; color: var(--muted); background: #1a1f3a; padding: 4px 8px; border-radius: 6px; margin-bottom: 4px; border-left: 2px solid var(--accent); }
    .meta { display:flex; gap:8px; align-items:center; font-size: 12px; color: var(--muted); }
    .name { font-weight: 700; color: var(--accent); cursor: pointer; }
    .name-admin { color: var(--admin) !important; }
    .text-admin { color: #fca5a5; }
    .time { opacity:.8; }
    .you { border-color: #2b375f; background: #10183a; }
    .status { font-size: 12px; color: var(--muted); padding: 4px 8px; background: var(--pill); border: 1px solid #2a3163; border-radius: 999px; }
    .vc-controls { display: grid; gap: 8px; }
    .vc-buttons { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; }
    .vc-participants { max-height: 200px; overflow-y: auto; }
    .participant { padding: 8px 12px; background: #0e1329; border: 1px solid #20264a; border-radius: 8px; margin-bottom: 4px; display: flex; align-items: center; gap: 8px; font-size: 14px; }
    .participant.speaking { border-color: var(--success); }
    .speaking-indicator { width: 8px; height: 8px; border-radius: 50%; background: var(--success); animation: pulse 1.5s infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .upload-area { position: relative; border: 2px dashed #262c4f; border-radius: 12px; padding: 20px; text-align: center; color: var(--muted); cursor: pointer; transition: all 0.3s ease; }
    .upload-area:hover { border-color: var(--accent); color: var(--accent); }
    .upload-area.dragover { border-color: var(--accent); background: rgba(125, 211, 252, 0.1); }
    .verification-screen { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(11, 14, 26, 0.95); display: flex; align-items: center; justify-content: center; z-index: 1000; }
    .verification-card { background: var(--card); border: 1px solid #1f2440; border-radius: 16px; padding: 32px; max-width: 400px; width: 90%; text-align: center; }
    footer { text-align:center; color:#778; font-size: 12px; margin-top: 16px; grid-column: 1 / -1; }
    
    /* Online Users List */
    .online-users-list { max-height: 300px; overflow-y: auto; }
    .user-item { display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: #0e1329; border: 1px solid #20264a; border-radius: 8px; margin-bottom: 4px; font-size: 14px; }
    .user-status { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
    .user-status.online { background: var(--success); box-shadow: 0 0 4px rgba(34, 197, 94, 0.6); }
    .user-status.unfocused { background: var(--warning); box-shadow: 0 0 4px rgba(245, 158, 11, 0.6); }
    .user-status.offline { background: var(--muted); }
    .user-name { flex: 1; }
    .user-count { font-size: 10px; color: var(--success); padding: 2px 6px; background: rgba(34, 197, 94, 0.1); border-radius: 4px; border: 1px solid rgba(34, 197, 94, 0.3); }

    /* Typing indicator styles */
    #typingIndicator { 
      font-size: 12px; 
      color: var(--muted); 
      margin: 6px 12px; 
      min-height: 16px;
      font-style: italic;
      opacity: 0;
      transition: opacity 0.2s ease;
    }
    
    #typingIndicator.active { 
      opacity: 1; 
    }
    
    #typingIndicator::before {
      content: "ğŸ’¬ ";
    }
    
    /* GIF panel improvements */
    #gifPanel {
      margin-top: 8px;
      animation: slideDown 0.2s ease;
    }
    
    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .gif-search-row {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    
    .gif-search-row input {
      flex: 1;
      margin-bottom: 0;
    }
    
    #gifResults {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 8px;
      max-height: 300px;
      overflow-y: auto;
    }
    
    .gif-item {
      aspect-ratio: 1;
      border-radius: 8px;
      cursor: pointer;
      transition: transform 0.1s ease, box-shadow 0.2s ease;
      object-fit: cover;
      width: 100%;
      height: 100%;
    }
    
    .gif-item:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(125, 211, 252, 0.3);
    }
    
    .gif-loading {
      text-align: center;
      padding: 20px;
      color: var(--muted);
    }
    
    .gif-error {
      text-align: center;
      padding: 20px;
      color: var(--danger);
    }
    
    .gif-empty {
      text-align: center;
      padding: 20px;
      color: var(--muted);
    }
    
    #gifBtn.active {
      background: var(--accent);
      color: #0f1220;
    }
    
    /* Emoji Picker Styles */
    #emojiPanel {
      position: absolute;
      bottom: 60px;
      right: 0;
      background: var(--card);
      border: 1px solid #1f2440;
      border-radius: 12px;
      padding: 12px;
      max-width: 320px;
      width: 90vw;
      max-height: 300px;
      overflow-y: auto;
      z-index: 100;
      box-shadow: 0 10px 30px rgba(0,0,0,.5);
      animation: slideUp 0.2s ease;
    }
    
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .emoji-search {
      width: 100%;
      margin-bottom: 8px;
      font-size: 12px;
      padding: 8px 10px;
    }
    
    .emoji-grid {
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      gap: 4px;
    }
    
    .emoji-item {
      padding: 6px;
      border-radius: 6px;
      cursor: pointer;
      text-align: center;
      transition: background 0.1s ease;
      font-size: 18px;
      user-select: none;
    }
    
    .emoji-item:hover {
      background: rgba(125, 211, 252, 0.2);
    }
    
    #emojiBtn.active {
      background: var(--accent);
      color: #0f1220;
    }
    
    /* Theme Toggle */
    .theme-toggle {
      display: flex;
      gap: 4px;
      background: #0e1222;
      border-radius: 8px;
      padding: 2px;
    }
    
    .theme-btn {
      padding: 4px 8px;
      border: none;
      background: transparent;
      border-radius: 6px;
      font-size: 12px;
    }
    
    .theme-btn.active {
      background: var(--accent);
      color: #0f1220;
    }
    
    /* Light theme */
    [data-theme="light"] {
      --bg: #f8fafc;
      --card: #ffffff;
      --pill: #e2e8f022;
      --accent: #0ea5e9;
      --muted: #64748b;
      --text: #1e293b;
      --success: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
    }
    
    [data-theme="light"] body {
      background: linear-gradient(180deg, #f8fafc, #e2e8f0);
    }
    
    [data-theme="light"] input, [data-theme="light"] select {
      background: #f1f5f9;
      border-color: #cbd5e1;
    }
    
    [data-theme="light"] #messages {
      background: #f8fafc;
      border-color: #e2e8f0;
    }
    
    [data-theme="light"] .msg {
      background: #ffffff;
      border-color: #e2e8f0;
    }
    
    [data-theme="light"] .theme-toggle {
      background: #f1f5f9;
    }
    
    /* Message Search */
    .search-results {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--bg);
      z-index: 50;
      padding: 8px;
      border-radius: 12px;
    }
    
    .search-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      font-size: 12px;
      color: var(--muted);
    }
    
    .close-search {
      background: var(--danger);
      color: white;
      border: none;
      border-radius: 4px;
      padding: 4px 8px;
      font-size: 10px;
    }
    
    /* Auto-scroll button */
    .scroll-to-bottom {
      position: absolute;
      bottom: 16px;
      right: 16px;
      background: var(--accent);
      color: #0f1220;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: all 0.2s ease;
      z-index: 10;
    }
    
    .scroll-to-bottom:hover {
      transform: scale(1.1);
    }
    
    .scroll-to-bottom.hidden {
      opacity: 0;
      pointer-events: none;
    }
    
    /* Notification sound controls */
    .sound-controls {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .sound-preview {
      padding: 4px 8px;
      font-size: 10px;
      background: var(--accent);
      color: #0f1220;
      border-radius: 4px;
      cursor: pointer;
    }
    
    @media (max-width: 768px) {
      .wrap { grid-template-columns: 1fr; }
      .sidebar { order: -1; }
      
      #gifResults {
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        gap: 6px;
      }
      
      #emojiPanel {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        border-radius: 12px 12px 0 0;
        max-width: none;
        width: 100%;
      }
      
      .emoji-grid {
        grid-template-columns: repeat(6, 1fr);
      }
    }
  </style>
</head>
<body>
  <!-- Verification Screen -->
  <div id="verificationScreen" class="verification-screen">
    <div class="verification-card">
      <div class="title" style="margin-bottom: 16px;">ğŸ”’ Access Required</div>
      <p>Enter the chat password to join:</p>
      
      <div class="stack">
        <div>
          <label for="passwordInput">Password</label>
          <input id="passwordInput" type="password" placeholder="Enter password..." />
        </div>
        <div>
          <label for="displayNameInput">Display Name</label>
          <input id="displayNameInput" type="text" placeholder="e.g., Onion" maxlength="20" />
        </div>
        <button id="enterChatBtn" class="success">ğŸšª Enter Chat</button>
      </div>
      
      <div id="errorMessage" style="color: var(--danger); margin-top: 16px; display: none;">
        âŒ Incorrect password. Try again.
      </div>
    </div>
  </div>

  <div class="wrap" id="mainApp" style="display: none;">
    <div class="main">
      <header>
        <div class="row" style="gap:10px">
          <div class="title">ğŸ˜› Pleb</div>
          <div id="conn" class="status" title="Connection status">â— Connectingâ€¦</div>
          <div id="onlineCount" class="user-count" style="display: none;"></div>
        </div>
        <div class="row" style="gap:8px">
          <div class="theme-toggle">
            <button id="darkBtn" class="theme-btn active">ğŸŒ™</button>
            <button id="lightBtn" class="theme-btn">â˜€ï¸</button>
          </div>
          <button id="clearBtn" title="Clear local data">Reset</button>
        </div>
      </header>

      <div class="card">
        <div class="section">
          <div class="row" style="align-items:flex-end">
            <div style="flex:1">
              <label for="displayName">Display name</label>
              <input id="displayName" type="text" placeholder="e.g., Onion" maxlength="20" />
            </div>
            <button id="saveNameBtn">Save</button>
          </div>
        </div>

        <div class="section">
          <div class="row" style="align-items:flex-end">
            <div style="flex:1">
              <label for="searchMessages">Search Messages</label>
              <input id="searchMessages" type="text" placeholder="Search chat history..." />
            </div>
            <button id="searchBtn">ğŸ”</button>
          </div>
        </div>

        <div class="section stack">
          <div id="messages" aria-live="polite" aria-label="Chat messages">
            <button id="scrollToBottom" class="scroll-to-bottom hidden">â¬‡ï¸</button>
          </div>
          <div id="typingIndicator"></div>
          
          <div class="upload-area" id="uploadArea">
            <div>ğŸ“¸ Drag & drop images here or click to select</div>
            <input type="file" id="imageInput" accept="image/*" multiple />
          </div>
          
          <!-- GIF Panel -->
          <div id="gifPanel" class="card" style="display:none;">
            <div class="section">
              <div class="gif-search-row">
                <input id="gifSearchInput" type="text" placeholder="Search GIFsâ€¦">
                <button id="gifSearchBtn">ğŸ”</button>
              </div>
            </div>
            <div class="section">
              <div id="gifResults" class="gif-loading">Loading trending GIFs...</div>
            </div>
          </div>
          
          <!-- Reply indicator -->
          <div id="replyIndicator" style="display:none; background: rgba(125, 211, 252, 0.1); border: 1px solid var(--accent); border-radius: 8px; padding: 8px; margin-bottom: 8px; font-size: 12px;">
            <span id="replyText"></span>
            <button id="cancelReply" style="float: right; background: var(--danger); color: white; border: none; border-radius: 4px; padding: 2px 6px; font-size: 10px;">âœ•</button>
          </div>
          
          <div class="row" style="position: relative;">
            <input id="messageInput" type="text" placeholder="Type a message and press Enterâ€¦" maxlength="500" />
            <button id="imageBtn" class="btn-icon" title="Upload Image">ğŸ“·</button>
            <button id="emojiBtn" class="btn-icon" title="Add Emoji">ğŸ˜€</button>
            <button id="gifBtn" class="btn-icon" title="Send GIF">ğŸ¬</button>
            <button id="sendBtn">Send</button>
            
            <!-- Emoji Panel -->
            <div id="emojiPanel" style="display:none;">
              <input class="emoji-search" id="emojiSearch" placeholder="Search emojis..." />
              <div class="emoji-grid" id="emojiGrid"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="sidebar">
      <!-- Online Users Card -->
      <div class="card">
        <div class="section">
          <label>Online Users (<span id="userCount">0</span>)</label>
          <div class="online-users-list" id="onlineUsersList">
            <div style="text-align: center; color: var(--muted); padding: 20px;">Loading users...</div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="section">
          <label>Voice Chat</label>
          <div class="vc-controls">
            <button id="joinVcBtn" class="success">ğŸ¤ Join Voice Chat</button>
            <div class="vc-buttons" id="vcButtons" style="display: none;">
              <button id="muteBtn" class="btn-icon" title="Mute/Unmute">ğŸ¤</button>
              <button id="deafenBtn" class="btn-icon" title="Deafen">ğŸ”Š</button>
              <button id="settingsBtn" class="btn-icon" title="Settings">âš™ï¸</button>
              <button id="leaveVcBtn" class="danger btn-icon" title="Leave VC">ğŸ“</button>
            </div>
          </div>
        </div>
      </div>

      <div class="card" id="participantsCard" style="display: none;">
        <div class="section">
          <label>Voice Participants (<span id="participantCount">0</span>)</label>
          <div class="vc-participants" id="participantsList"></div>
        </div>
      </div>

      <div class="card" id="settingsCard" style="display: none;">
        <div class="section">
          <label>Audio Settings</label>
          <div class="stack">
            <div>
              <label for="micSelect">Microphone</label>
              <select id="micSelect">
                <option>Default</option>
              </select>
            </div>
            <div>
              <label for="volumeSlider">Volume: <span id="volumeValue">100%</span></label>
              <input type="range" id="volumeSlider" min="0" max="100" value="100" />
            </div>
            <button id="testMicBtn">Test Microphone</button>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="section">
          <label>Chat Features</label>
          <div class="stack">
            <div>
              <label for="autoScroll">Auto-scroll to bottom</label>
              <input type="checkbox" id="autoScroll" checked />
            </div>
            <div>
              <div class="sound-controls">
                <input type="checkbox" id="soundNotifications" />
                <label for="soundNotifications" style="margin: 0; flex: 1;">Sound notifications</label>
                <button id="testSoundBtn" class="sound-preview">ğŸ”Š Test</button>
              </div>
            </div>
            <div>
              <label for="notificationVolume">Notification Volume: <span id="notificationVolumeValue">50%</span></label>
              <input type="range" id="notificationVolume" min="0" max="100" value="50" />
            </div>
            <div>
              <label for="compactMode">Compact message view</label>
              <input type="checkbox" id="compactMode" />
            </div>
            <div>
              <label for="messageLimit">Messages to load: <span id="messageLimitValue">200</span></label>
              <input type="range" id="messageLimit" min="50" max="500" step="50" value="200" />
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer>
      Built with Firebase Realtime Database Â· Be nice, stay cozy âœ¨
    </footer>
  </div>

  <!-- Firebase + App Script -->
  <script type="module">
    // --- Firebase SDKs ---
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
    import { getDatabase, ref, push, serverTimestamp, onChildAdded, limitToLast, query, orderByChild, onValue, set, remove, onDisconnect } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js';

    // Your config
    const firebaseConfig = {
      apiKey: "AIzaSyAUhiB3d042QEfM5qWdC5qYGt7hrcqKolc",
      authDomain: "chatting-6cd81.firebaseapp.com",
      databaseURL: "https://chatting-6cd81-default-rtdb.firebaseio.com",
      projectId: "chatting-6cd81",
      storageBucket: "chatting-6cd81.firebasestorage.app",
      messagingSenderId: "584471983807",
      appId: "1:584471983807:web:b71eb2ba2a071d311b380a",
      measurementId: "G-53H0MM5V6M"
    };

    // Init
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // CHANGE THIS PASSWORD TO WHATEVER YOU WANT
    const CHAT_PASSWORD = "plebous123ous";
    
    // GIF API
    const GIPHY_KEY = "bDiYI9SyxC1DGIdqZe3ZdbnFsOHJGlBm";

    // Emoji data
    const EMOJIS = [
      'ğŸ˜€','ğŸ˜ƒ','ğŸ˜„','ğŸ˜','ğŸ˜†','ğŸ˜…','ğŸ¤£','ğŸ˜‚','ğŸ™‚','ğŸ™ƒ','ğŸ˜‰','ğŸ˜Š','ğŸ˜‡','ğŸ¥°','ğŸ˜','ğŸ¤©','ğŸ˜˜','ğŸ˜—','â˜ºï¸','ğŸ˜š','ğŸ˜™','ğŸ¥²','ğŸ˜‹','ğŸ˜›','ğŸ˜œ','ğŸ¤ª','ğŸ˜','ğŸ¤‘','ğŸ¤—','ğŸ¤­','ğŸ¤«','ğŸ¤”','ğŸ¤','ğŸ¤¨','ğŸ˜','ğŸ˜‘','ğŸ˜¶','ğŸ˜','ğŸ˜’','ğŸ™„','ğŸ˜¬','ğŸ¤¥','ğŸ˜Œ','ğŸ˜”','ğŸ˜ª','ğŸ¤¤','ğŸ˜´','ğŸ˜·','ğŸ¤’','ğŸ¤•','ğŸ¤¢','ğŸ¤®','ğŸ¤§','ğŸ¥µ','ğŸ¥¶','ğŸ¥´','ğŸ˜µ','ğŸ¤¯','ğŸ¤ ','ğŸ¥³','ğŸ¥¸','ğŸ˜','ğŸ¤“','ğŸ§','ğŸ˜•','ğŸ˜Ÿ','ğŸ™','â˜¹ï¸','ğŸ˜®','ğŸ˜¯','ğŸ˜²','ğŸ˜³','ğŸ¥º','ğŸ˜¦','ğŸ˜§','ğŸ˜¨','ğŸ˜°','ğŸ˜¥','ğŸ˜¢','ğŸ˜­','ğŸ˜±','ğŸ˜–','ğŸ˜£','ğŸ˜','ğŸ˜“','ğŸ˜©','
